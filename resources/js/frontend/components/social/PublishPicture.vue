<template>
    <div class="multi-step-form" style="max-width: 100vw;">
        <div class="multi-form py-3 mx-3">
            <div class="inner">
                <ul class="steps p-0" @click="onClickListener($event)">
                    <!-- Step 1 - é¸æ“‡åœ–ç‰‡ Start -->
                    <li ref="listItem1" class="listItem show" id="step1">
                        <div class="col1">
                            <span class="step">
                                <span>1</span>
                                <span class="checkmark"></span>
                            </span>
                            <span class="line"></span>
                        </div>
                        <div ref="stepBody" class="col2 stepBody">
                            <div class="stepTitle">
                                Step 1 - é¸æ“‡åœ–ç‰‡
                            </div>
                            <div class="content">
                                <div class="mw-100 my-2 mx-2"
                                    style="height: 600px; border: 4px dashed var(--color-success); border-radius: 24px; cursor: pointer;"
                                    v-if="picture !== null"
                                    @click="$refs.picturePicker.click()">
                                    <img class="rounded mx-auto d-block h-100"
                                        ref="previewPicture" />
                                </div>
                                <div :class="{ 'image-upload-wrap my-2 mx-2' : picture === null }"
                                    @click="$refs.picturePicker.click()">
                                    <input type="file"
                                        id="picturePicker"
                                        ref="picturePicker"
                                        accept="image/*"
                                        @change="pictureUpload($event)" />
                                    <div class="text-center text-success py-5 px-2"
                                        v-if="picture === null">
                                        <h3>å°‡åœ–ç‰‡æ‹–æ›³åˆ°æ­¤è™•ï¼Œæˆ–é»æ“Šä¸Šå‚³</h3>
                                    </div>
                                </div>
                                <p class="text-danger m-0 pb-0">é™„è¨»ä¸€ï¼šç›®å‰åƒ…æ”¯æ´ <strong>"jpg"ã€"jpeg"ã€"png"ã€"gif"</strong> åœ–ç‰‡æ ¼å¼çš„ä¸Šå‚³ã€‚</p>
                                <p class="text-danger m-0 pt-0 pb-2">é™„è¨»äºŒï¼šåœ–ç‰‡å®¹é‡å¤§å°é™åˆ¶ <strong>10MB</strong> ä»¥ä¸‹ã€‚</p>
                                <p v-if="picture !== null" v-text="`å“ˆå›‰ï¼æ‚¨ä¸Šå‚³çš„åœ–ç‰‡æ˜¯ã€Œ${picture.name}ã€ï¼Œå¦‚æœæ²’å•é¡Œå¯ä»¥å‰å¾€ä¸‹ä¸€æ­¥ã€‚`"></p>
                                <div class="buttons">
                                    <button class="next"
                                        :disabled="picture === null">
                                        ä¸‹ä¸€æ­¥
                                    </button>
                                </div>
                            </div>
                        </div>
                    </li>
                    <!-- Step 1 - é¸æ“‡åœ–ç‰‡ End -->

                    <!-- Step 2 - ç·¨è¼¯æ–‡ç« å…§å®¹ Start -->
                    <li ref="listItem2" class="listItem" id="step2">
                        <div class="col1">
                            <span class="step">
                                <span>2</span>
                                <span class="checkmark"></span>
                            </span>
                            <span class="line"></span>
                        </div>
                        <div ref="stepBody" class="col2 stepBody">
                            <div class="stepTitle">
                                Step 2 - ç·¨è¼¯æ–‡ç« å…§å®¹
                            </div>
                            <div class="content">
                                <div class="inputGroup">
                                    <label for="name">è·Ÿå¤§å®¶åˆ†äº«ä½ çš„é åŒ—äº‹å§ã€‚</label>
                                    <textarea
                                        class="form-control cards-editor"
                                        rows="8"
                                        minlength="30"
                                        maxlength="4096"
                                        v-model="content"
                                        required
                                        @keyup="onKeyupListener($event)"></textarea>
                                </div>
                                <div class="buttons pt-2">
                                    <button class="next" disabled>ä¸‹ä¸€æ­¥</button>
                                    <button class="prev">è¿”å›</button>
                                </div>
                            </div>
                        </div>
                    </li>
                    <!-- Step 2 - ç·¨è¼¯æ–‡ç« å…§å®¹ End -->

                    <!-- Step 3 - åŒæ„ç‰ˆè¦ Start -->
                    <li ref="listItem3" class="listItem" id="step3">
                        <div class="col1">
                            <span class="step">
                                <span>3</span>
                                <span class="checkmark"></span>
                            </span>
                            <span class="line"></span>
                        </div>
                        <div ref="stepBody" class="col2 stepBody">
                            <div class="stepTitle">
                                Step 3 - åŒæ„ç‰ˆè¦
                            </div>
                            <div class="jumbotron jumbotron-fluid rounded p-2 mt-2">
                                <div class="container p-0">
                                    <h1 class="text-center w-100 py-2 my-0">å…§å®¹å®ˆå‰‡</h1>
                                    <h3>ä¸€ã€è²¬ä»»è²æ˜ï¼š</h3>
                                    <p>æœ¬ç«™ä½¿ç”¨è€…é ˆå°è‡ªå·±æ‰€å¼µè²¼ä¹‹æ¯ä¸€ç¯‡æ–‡ç« è² è²¬ï¼Œæœ¬ç«™æ¯‹éœ€å°ç«™å…§ä»¥åŠå…¶ä»–é—œè¯ä¹‹ç¤¾ç¾¤åª’é«”çš„è¨€è«–è² æ“”èµ·ä»»ä½•çš„è²¬ä»»ï¼Œè²¬ä»»çš„æ­¸å±¬æ¬Šå±¬æ–¼å„ä½ç™¼è¡¨äººã€‚</p>
                                    <h3>äºŒã€ç™¼è¡¨æ–‡ç« æ™‚ä¹‹æ³¨æ„äº‹é …ï¼š</h3>
                                    <ol class="pb-2">
                                        <li>å°Šé‡ä»–äººæ„è¦‹ï¼Œæ³¨æ„ç”¨å­—é£è©èˆ‡å£æ°£ï¼Œé¿å…å¼•èµ·çˆ­åµã€‚</li>
                                        <li>é¿å…åœ¨å…¬çœ¾å€åŸŸï¼Œè¨è«–ç§äººäº‹å‹™ã€‚</li>
                                        <li>é¿å…ç™¼è¡¨æ–‡ç« æ–¼éç›¸é—œå€åŸŸï¼Œæ–‡ç« æ¨™é¡ŒåŠå…§å®¹ä¸ç¬¦åˆè¨è«–å€ä¹‹è¨è«–ä¸»é¡Œã€‚</li>
                                        <li>ç¦æ­¢é‡è¤‡åˆŠç™»ç›¸åŒå…§å®¹æˆ–ç›¸åŒæ„ç¾©ä¹‹ç•™è¨€ã€‚</li>
                                        <li>é©åº¦å¼•ç”¨æ–‡ç« ï¼Œé¿å…å¼•ç”¨éé•·æ–‡ç« ï¼Œé€ æˆé–±è®€å›°æ“¾ã€‚</li>
                                        <li>ä¸é©ç•¶çš„å»£å‘Šã€å®£å‚³æ´»å‹•æˆ–å•†æ¥­æ€§ç•™è¨€ã€‚</li>
                                        <li>ç¦æ­¢ç™¼è¡¨è¬¾ç½µã€è„…è¿«ã€æŒ‘é‡ã€çŒ¥è¤»æˆ–ä¸é›…ä¹‹æ–‡å­—ã€‚</li>
                                        <li>ç¦æ­¢ç™¼è¡¨å€‹äººæ¸¬è©¦ç”¨æ–‡ç« æˆ–æ•£æ’­ä¸å¯¦æ¶ˆæ¯ä¹‹æ–‡ç« ï¼Œå¼µè²¼æ–‡ç« ï¼Œæ‡‰è‡ªè² ç›¸é—œæ³•å¾‹è²¬ä»»ã€‚</li>
                                        <li>è½‰è²¼ä»»ä½•æ–‡ç« è«‹é™„ä¸ŠåŸä½œè€…è²¨ä¾†æºï¼Œå¦å‰‡ç‰ˆä¸»æœƒè¦ªè‡ªå»å•æˆæ¬Šã€è™•ç†æ–¹å¼ï¼Œä¸¦ä¸”æŠŠæ‚¨çš„å¸³è™Ÿå°é–ã€‚</li>
                                        <li>ç¦æ­¢ä»¥ç™¼è¡¨é˜²ç–«ç›¸é—œçš„èª¿ä¾ƒã€åé˜²ç–«ç›¸é—œè¨€è«–ã€‚</li>
                                        <li>è‹¥æœ‰æœªè¦å®šçš„éƒ¨ä»½ï¼Œç”±ç‰ˆä¸»ä¾ä¸»è§€èªå®šï¼Œè¦–æƒ…æ³è™•ç†ã€‚</li>
                                    </ol>
                                    <h3>ä¸‰ã€é•è¦è™•ç†è¾¦æ³•ï¼š</h3>
                                    <p>é•åä¸Šè¿°è¦å®šä¹‹æ–‡ç« æˆ–ä½œè€…ï¼Œç‰ˆä¸»å¯åˆªé™¤æ–‡ç« æˆ–è¡Œä½¿ç¦è²¼ä¹‹è™•ä»½ã€‚</p>
                                    <h3>å››ã€é™„è¨»åŠè£œå……èªªæ˜ï¼š</h3>
                                    <ol class="pb-2">
                                        <li>æœ¬ç«™æ­¡è¿ç¶²å‹äº’ç›¸è¨è«–ç™¼è¡¨å·±è¦‹ï¼Œå”¯è«‹å‹™å¿…éµå®ˆä¸Šè¿°è¦å®šã€‚</li>
                                        <li>æ˜¯å¦é•åä¸Šè¿°è¦å®šï¼Œç”±ç‰ˆä¸»ä¸»è§€èªå®šï¼Œè«‹è¬¹æ…ç”¨è©ã€‚</li>
                                        <li>è«‹å­¸ç¿’åŒ…å®¹å„ç¨®æ„è¦‹ï¼Œå¦‚é‡æƒ¡æ„æ‰¹è©•æˆ–æ”»æ“Šä¹‹æ–‡ç« ï¼Œåˆ‡å‹¿åŠ å…¥çˆ­åŸ·ï¼Œä¸¦ä¸”å–„ç”¨æª¢èˆ‰ï¼Œç‰ˆä¸»æœƒæœ‰é©ç•¶ä¹‹è™•ç†ï¼Œå¦å‰‡é›™æ–¹</li>çš†ä¾ä¸Šè¿°è¦å®šè™•ç†ã€‚
                                    </ol>
                                </div>
                                <div class="mt-2 text-center">
                                    <input class="tgl tgl-flip" id="consent" type="checkbox" v-model="consent"/>
                                    <label style="display: inline-block;" class="tgl-btn mt-2 mr-2" data-tg-off="æ°å“¥ä¸è¦ï¼ğŸ˜±" data-tg-on="å¥½ã„›ğŸ¥´" for="consent"></label>
                                    <label style="display: inline-block;" :class="[consent ? 'text-success' : 'text-danger']" for="consent">
                                        {{ consent ? 'æˆ‘çœ‹å®Œäº†ï¼Œæˆ‘é¡˜æ„éµå®ˆä»¥ä¸Šçš„å…§å®¹å®ˆå‰‡ï¼Œæ‰€ä»¥æˆ‘æŒ‰äº†ã€Œå¥½ã„›ğŸ¥´ã€ä»¥è¡¨ç¤ºæˆ‘åŒæ„ã€‚' : 'æ°å“¥ï¼Œä¸è¦å•¦ï¼æ°å“¥ä¸è¦ï¼æˆ‘ä¸æƒ³éµå®ˆã€Œå…§å®¹å®ˆå‰‡ã€ğŸ˜­' }}
                                    </label>
                                </div>
                                <div class="buttons pt-2">
                                    <button class="next" :disabled="!consent">ä¸‹ä¸€æ­¥</button>
                                    <button class="prev" style="background-color: var(--background-secondary);">è¿”å›</button>
                                </div>
                            </div>
                        </div>
                    </li>
                    <!-- Step 3 - åŒæ„ç‰ˆè¦ End -->

                    <!-- Step 4 - æœ€å¾Œç¢ºèª Start -->
                    <li ref="listItem4" class="listItem" id="step4">
                        <div class="col1">
                            <span class="step">
                                <span>4</span>
                                <span class="checkmark"></span>
                            </span>
                            <span class="line"></span>
                        </div>
                        <div ref="stepBody" class="col2 stepBody">
                            <div class="stepTitle">
                                Step 4 - æœ€å¾Œç¢ºèª
                            </div>
                            <div class="content">
                                <div class="pt-2"
                                    v-if="final !== 'success'">
                                    <div class="row mb-5" style="max-height: 1200px;">
                                        <div class="col-md-6">
                                            <img class="rounded mx-auto d-block w-100"
                                                style="max-height: 600px;"
                                                :src="pictureSrc" />
                                        </div>
                                        <div class="col-md-6">
                                            <h3 v-if="picture !== null">æ‚¨ä¸Šå‚³çš„åœ–ç‰‡æ˜¯ã€Œ{{ picture.name }}ã€</h3>
                                            <p style="font-size: 24px;">{{ content }}</p>
                                        </div>
                                    </div>
                                    <h3 class="w-100">å¥½æ£’ï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘åªè¦ã€Œé€å‡ºæŠ•ç¨¿ã€å°±å¯ä»¥äº†ï¼</h3>
                                    <div class="buttons">
                                        <button type="button"
                                            class="submit btn yes"
                                            @click="submitForm()"
                                            :disabled="final !== null">
                                            <div v-if="final === null">
                                                é€å‡ºæŠ•ç¨¿
                                            </div>
                                            <div v-else>
                                                <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                                                <span class="sr-only">Loading...</span>
                                            </div>
                                        </button>
                                        <button class="prev" v-if="final === null">è¿”å›</button>
                                    </div>
                                </div>
                                <div v-if="final === 'success'">
                                    <h3 class="success">æ‚¨æˆåŠŸé€å‡ºæŠ•ç¨¿äº†ï¼</h3>
                                    <p>ä¸éæ–‡ç« é‚„æ²’æœ‰è¢«ç™¼è¡¨å‡ºå»ï¼Œéœ€è¦ç¶“éç¾¤çœ¾å¯©æ ¸ï¼Œä½ ä¹Ÿå¯ä»¥åƒèˆ‡ç¾¤çœ¾å¯©æ ¸ï¼Œå¹«è‡ªå·±çš„æ–‡ç« æŠ•ç¥¨ï¼Œ</p>
                                </div>
                            </div>
                        </div>
                    </li>
                    <!-- Step 4 - æœ€å¾Œç¢ºèª End -->

                    <!-- Step 5 - å®Œæˆ Start -->
                    <li ref="listItem5" class="listItem" id="step5">
                        <div class="col1">
                            <span class="step">
                                <span>5</span>
                                <span class="checkmark"></span>
                            </span>
                            <span class="line"></span>
                        </div>
                        <div ref="stepBody" class="col2 stepBody">
                            <div class="stepTitle">
                                Step 5 - å®Œæˆ
                            </div>
                            <div class="content">
                                <div class="col-md-8 offset-md-2 mb-3" id="flowchart">
                                    <div class="row">
                                        <ul class="col-12">
                                            <li class="flow-step flow-light">æ–‡ç« æŠ•ç¨¿</li>
                                            <li class="flow-arrow">
                                                <i class="fas fa-arrow-down"></i>
                                            </li>
                                            <li class="flow-step flow-light">
                                                <p class="mb-0">é€å‡ºæŠ•ç¨¿</p>
                                                <h5>
                                                    <span class="badge badge-pill badge-secondary">æ‚¨ç¾åœ¨åœ¨é€™è£¡</span>
                                                </h5>
                                            </li>
                                            <li class="flow-arrow">
                                                <i class="fas fa-arrow-down"></i>
                                            </li>
                                            <li class="flow-step flow-light">
                                                <p class="mb-0">é€²å…¥ç¾¤çœ¾å¯©æ ¸ç³»çµ±</p>
                                                <a href="/cards/review" class="p-0">
                                                    <h5>
                                                        <span class="badge badge-pill badge-primary">å‰å¾€æŠ•ç¥¨</span>
                                                    </h5>
                                                </a>
                                            </li>
                                        </ul>
                                        <ul class="col-4">
                                            <li class="flow-arrow text-success">
                                                <i class="fas fa-arrow-down text-success mr-2"></i>
                                                åŒæ„æ•¸é”æ¨™
                                            </li>
                                            <li class="flow-step flow-success">
                                                <p class="m-0">æ–‡ç« ç™¼è¡¨</p>
                                                <p class="m-0">å„ç¤¾ç¾¤å¹³å°</p>
                                            </li>
                                        </ul>
                                        <ul class="col-8">
                                            <li class="flow-arrow text-warning">
                                                <i class="fas fa-arrow-down text-warning mr-2"></i>
                                                å¦æ±ºç¥¨éå¤š
                                            </li>
                                            <li class="flow-step flow-warning">
                                                <p class="m-0">æš«æ™‚æ“±ç½®</p>
                                                <p class="m-0">ç­‰å¾…ç®¡ç†å“¡å¯©æ ¸</p>
                                            </li>
                                        </ul>
                                        <ul class="col-2">
                                            <!-- ç©ºçš„ -->
                                        </ul>
                                        <ul class="col-5">
                                            <li class="flow-arrow text-success">
                                                å¯©æ ¸é€šé
                                                <i class="fas fa-arrow-down text-success ml-2"></i>
                                            </li>
                                            <li class="flow-step flow-success">
                                                <p class="m-0">æ–‡ç« ç™¼è¡¨</p>
                                                <p class="m-0">å„ç¤¾ç¾¤å¹³å°</p>
                                            </li>
                                        </ul>
                                        <ul class="col-5">
                                            <li class="flow-arrow text-danger">
                                                <i class="fas fa-arrow-down text-danger mr-2"></i>
                                                å¯©æ ¸ä¸é€šé
                                            </li>
                                            <li class="flow-step flow-danger">
                                                <p class="m-0">æŠ•ç¨¿å¤±æ•—</p>
                                                <p class="m-0">æ–‡ç« çŸ³æ²ˆå¤§æµ·</p>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </li>
                    <!-- Step 5 - å®Œæˆ End -->
                </ul>
            </div>
        </div>
    </div>
</template>

<script>
export default {
    name: "PublishArticle",
    data() {
        return {
            stepsWrapper: null,
            listItems: null,
            inputs: null,
            content: '',
            consent: false,
            final: null,
            picture: null,
            pictureSrc: null,
        };
    },
    mounted() {
        this.stepsWrapper = document.querySelector(".steps")
        this.listItems = this.stepsWrapper.querySelectorAll(".listItem")
        this.inputs = this.stepsWrapper.querySelectorAll("input")

        // é è¨­æ‰“é–‹ Step 1
        this.changeSteps(this.$refs.listItem1, this.$refs.listItem1);
    },
    methods: {
        /**
         * åœ–ç‰‡ä¸Šå‚³çš„è§¸ç™¼äº‹ä»¶
         *
         * @param elements event
         *
         * @return void
         */
        pictureUpload(event) {
            // åˆ¤æ–·æ˜¯å¦æœ‰æŠ“åˆ°æª”æ¡ˆ
            if (event.target.files && event.target.files[0]) {
                let uploaded = event.target.files[0];

                // åˆ¤æ–·æª”æ¡ˆçš„æ ¼å¼æ˜¯å¦æ­£ç¢º
                let accepted = ["jpg", "jpeg", "png", "gif"];
                if (!new RegExp(accepted.join("|")).test(uploaded.type)) {
                    Swal.fire(
                        'å™¢å™—ï¼æ‚¨çš„åœ–ç‰‡æ ¼å¼ä¸æ”¯æ´ï¼',
                        'ç›®å‰åƒ…æ”¯æ´ <strong>"jpg"ã€"jpeg"ã€"png"ã€"gif"</strong> åœ–ç‰‡æ ¼å¼çš„ä¸Šå‚³ï¼Œéœ€è¦éº»ç…©æ‚¨å¹«åœ–ç‰‡è½‰æˆæˆ‘å€‘æ”¯æ´çš„æ ¼å¼ï¼Œå†ä¾†é‡æ–°æŠ•ç¨¿ã€‚',
                        'error'
                    );
                    return;
                }

                // åˆ¤æ–·æª”æ¡ˆçš„å®¹é‡å¤§å°æ˜¯å¦è¶…æ¨™
                if (uploaded.size >= (10 * 1024 * 1024)) {
                    Swal.fire(
                        'å™¢å™—ï¼æ‚¨çš„åœ–ç‰‡å¤ªå¤§äº†ï¼',
                        'åœ–ç‰‡å®¹é‡å¤§å°é™åˆ¶ <strong>10MB</strong> ä»¥ä¸‹ï¼Œå»ºè­°æ‚¨å£“ç¸®ä¸€ä¸‹åœ–ç‰‡ï¼Œå†ä¾†é‡æ–°æŠ•ç¨¿ã€‚',
                        'error'
                    );
                    return;
                }

                // åœ–ç‰‡æ ¼å¼ã€å®¹é‡å¤§å°éƒ½æ²’å•é¡Œï¼Œé–‹å§‹æº–å‚™é è¦½åœ–
                this.picture = uploaded;
                let reader = new FileReader();
                let self = this;
                reader.onload = function () {
                    self.$refs.previewPicture.src = reader.result;
                    self.pictureSrc = reader.result;
                    self.changeSteps(self.$refs.listItem1, self.$refs.listItem1);
                };
                reader.readAsDataURL(self.picture);

                return;
            }

            // æ—¢æ²’æœ‰æª”æ¡ˆï¼Œä¹Ÿä¸æ›‰å¾—ä¸Šå‚³äº†ä»€éº¼ï¼Œé‚„è§¸ç™¼äº‹ä»¶
            Swal.fire(
                'è›¤ï¼Ÿä½ ä¸Šå‚³äº†ä»€éº¼ï¼Ÿ',
                'æˆ‘ä¸çŸ¥é“ä½ æ˜¯èª°ï¼Œæˆ‘ä¸çŸ¥é“ä½ æƒ³è¦ä»€éº¼ï¼Œå¦‚æœä½ æƒ³æ‰¾æˆ‘ï¼Œé‚£æˆ‘å¯ä»¥å‘Šè¨´ä½ ç§è¨Šç²‰çµ²å°ˆé å°±å¯ä»¥æ‰¾åˆ°æˆ‘ï¼Œå¦‚æœä½ é¦¬ä¸ŠæŠŠä½ å‰›å‰›åšçš„äº‹æƒ…æ‹¿å»<a href="https://github.com/init-engineer/init.engineer"> GitHub repo </a>ç™¼å€‹ issue çµ¦æˆ‘ï¼Œæˆ‘å°±ç•¶ä½œæ²’é€™å›äº‹ï¼Œæˆ‘ä¸æœƒå»æ‰¾ä½ ï¼Œä¹Ÿä¸æœƒè¿½æŸ¥ä½ ï¼Œå¦‚æœä½ ä¸å°±æ­¤ç½·æ‰‹ï¼Œæˆ‘æœƒå»æ‰¾ä½ ï¼Œæˆ‘æœƒæ‰¾åˆ°ä½ ï¼Œæˆ‘æœƒç”¨ä½ çš„è£ç½®ä¾†å¹«æˆ‘è‡ªå·± Debugã€‚',
                'error'
            );
            return;
        },
        /**
         * å…§å®¹æ›´æ–°çš„è§¸ç™¼äº‹ä»¶
         *
         * @param elements event
         *
         * @return void
         */
        onKeyupListener(event) {
            // ç”¨ keyup ç‚ºæ¯å€‹ input æ·»åŠ ç„¦é»
            const inputWrapper = event.target.closest(".inputGroup");
            const nextButton = inputWrapper
                .closest(".stepBody")
                .querySelector(".next");

            // å¦‚æœæ˜¯åŒæ„å…§å®¹å®ˆå‰‡ï¼Œå…§å®¹å®ˆå‰‡è¢«åŒæ„äº†å‰‡å•Ÿç”¨ä¸‹ä¸€æ­¥æŒ‰éˆ•
            if (this.consent) {
                return (nextButton.disabled = false);
            }

            // å¦‚æœæ²’æœ‰ valueï¼Œå‰‡ç§»é™¤ç„¦é»ï¼Œç¦ç”¨ä¸‹ä¸€æ­¥æŒ‰éˆ•ä¸¦ return
            if (!event.target.value) {
                inputWrapper.closest(".listItem").classList.remove("done");
                inputWrapper.classList.remove("js-focus");
                return (nextButton.disabled = true);
            }
            inputWrapper.classList.add("js-focus");

            // å¦‚æœä»æœ‰è¼¸å…¥ç‚ºç©ºï¼Œå‰‡ç¦ç”¨ä¸‹ä¸€å€‹æŒ‰éˆ•
            if (inputWrapper.nextElementSibling.classList.contains("inputGroup") &&
               !inputWrapper.nextElementSibling.querySelector("input").value) {
                return;
            }

            // å¦‚æœä¸»è¦å…§å®¹è¼¸å…¥é•·åº¦å°æ–¼ 30 å­—å…ƒ
            if (this.content.length < 30) {
                return;
            }

            // å¦å‰‡å•Ÿç”¨ä¸‹ä¸€æ­¥æŒ‰éˆ•
            nextButton.disabled = false;
        },
        /**
         * æŒ‰éˆ•é»æ“Šçš„è§¸ç™¼äº‹ä»¶
         *
         * @param elements event
         *
         * @return void
         */
        onClickListener(event) {
            // å¦‚æœå–®æ“Šä¸åœ¨æŒ‰éˆ•ä¸Šï¼Œå‰‡è¿”å›
            if (!event.target.closest("button")) {
                return;
            }

            const btn = event.target;
            const currentStep = btn.closest(".listItem");

            btn.classList.contains("next")
                ? this.changeSteps(currentStep, currentStep.nextElementSibling)
                : btn.classList.contains("prev")
                    ? this.changeSteps(currentStep, currentStep.previousElementSibling)
                    : null;
        },
        /**
         * ç•¶ä½¿ç”¨è€…æŒ‰ä¸‹æŠ•ç¨¿çš„æŒ‰éˆ•å¾Œï¼ŒåŸ·è¡Œåœ–ç‰‡æŠ•ç¨¿çš„å‹•ä½œ
         *
         * @return void
         */
        submitForm() {
            // å°‡ç›®å‰ç‹€æ…‹æ”¹ç‚ºç™¼é€è¡¨å–®ç•¶ä¸­
            this.final = 'submit';

            // å½™æ•´è³‡æ–™æ ¼å¼ä¸¦åŸ·è¡Œå‘¼å« API
            let self = this;
            let formData = new FormData();
                formData.append('content', self.content);
                formData.append('picture', self.picture);
            axios.post(`/api/social/cards/publish/picture`, formData, {
                headers: {
                    'Content-Type': 'multipart/form-data',
                },
            }).then((response) => {
                    // åœ–ç‰‡æŠ•ç¨¿æˆåŠŸï¼Œå°‡ç›®å‰ç‹€æ…‹æ”¹ç‚ºç™¼è¡¨æˆåŠŸï¼Œå°‡é é¢ç§»å‹•åˆ°å®Œæˆé é¢
                    self.final = 'success';
                    self.changeSteps(self.$refs.listItem4, self.$refs.listItem5);

                    // å–å‡ºæŠ•ç¨¿ç·¨è™Ÿï¼Œä¸¦é¡¯ç¤ºè¨Šæ¯çµ¦ä½¿ç”¨è€…çœ‹
                    let id = response.data.data.id;
                    Swal.fire(
                        'æ‚¨æˆåŠŸæŠ•ç¨¿åœ–ç‰‡äº†ï¼',
                        `æ‚¨çš„æ–‡ç« ç·¨è™Ÿç‚º<a href="/cards/show/${id}"> ${id}(#${id.toString(36)}) </a>æ‚¨çš„æŠ•ç¨¿æ¥ä¸‹ä¾†æœƒé€²å…¥<a href="/cards/review">ç¾¤çœ¾å¯©æ ¸ç³»çµ±</a>ç•¶ä¸­ç­‰å¾…å¯©æ ¸ï¼Œé€™é …ç³»çµ±æ˜¯æ‰€æœ‰äººéƒ½èƒ½åƒèˆ‡çš„ï¼Œæ‚¨ä¹Ÿå¯ä»¥æŠ•ç¥¨çµ¦è‡ªå·±æŠ•ç¨¿çš„æ–‡ç« ï¼ŒåŠ é€Ÿæ–‡ç« è¢«ç™¼è¡¨çš„é€Ÿåº¦ã€‚`,
                        'success'
                    );
                })
                .catch((error) => {
                    // åœ–ç‰‡æŠ•ç¨¿å¤±æ•—ï¼Œå°‡ç›®å‰è£æ…‹æ”¹ç‚ºåˆå§‹ç‹€æ…‹ï¼Œä¸¦é¡¯ç¤º Error é€šçŸ¥
                    self.final = null;
                    Swal.fire(
                        'å™¢å™—ï¼æ€ªæ€ªçš„ï¼Ÿ',
                        'æŠ•ç¨¿åœ–ç‰‡æ™‚ç™¼ç”Ÿäº†ä¸€äº›éŒ¯èª¤ï¼Œå¯ä»¥çš„è©±ï¼ŒæŠŠé€™é …å•é¡Œæ‹¿åˆ°<a href="https://github.com/init-engineer/init.engineer"> GitHub repo </a>ç™¼å€‹ issue çµ¦æˆ‘ï¼Œè¬è¬ä½  m(_ _)m',
                        'error'
                    );
                });
        },
        /**
         * è¨ˆç®— Step éœ€è¦é—œé–‰åŠå±•é–‹çš„é é¢é«˜åº¦
         *
         * @param elements currentStep
         * @param elements newStep
         *
         * @return void
         */
        changeSteps(currentStep, newStep) {
            // å–å¾—å°šæœªé—œé–‰çš„ Step é«˜åº¦ï¼Œä¸¦å°‡ç•¶å‰ Step é—œé–‰
            currentStep.style.height = getComputedStyle(newStep).height;
            currentStep.classList.remove("show");

            // å¦‚æœæŒ‰ä¸‹ç¹¼çºŒæŒ‰éˆ•ï¼Œå‰‡æ·»åŠ è¤‡é¸æ¨™è¨˜
            if (newStep === currentStep.nextElementSibling)
                currentStep.classList.add("done");

            // æ‰“é–‹ä¸‹ä¸€æ­¥
            const contentHeight = newStep
                .querySelector(".stepBody")
                .getBoundingClientRect().height;
            newStep.style.height = `${contentHeight}px`;
            newStep.classList.add("show");

            // åŸ·è¡Œç•«é¢ç§»å‹•çš„å‹•ä½œ
            this.scrollTo(newStep.id);
        },
        /**
         * å°‡ç•«é¢ç§»å‹•åˆ°æŒ‡å®šçš„ Step
         *
         * @param string id æ­¥é©Ÿ ID æ¨™ç±¤ï¼Œç”¨ä¾†åˆ¤æ–·ç•«é¢éœ€è¦ç§»å‹•åˆ°å“ªå€‹æ­¥é©Ÿ
         *
         * @return void
         */
        scrollTo(id) {
            // è¨ˆç®— alert å…¬å‘Šçš„é«˜åº¦
            let alert = document.getElementsByClassName('alert');
            let alertHeight = 48;
            for (var i = 0; i < alert.length; i++) {
                alertHeight = alertHeight + alert[i].getBoundingClientRect().height;
            }

            // æ ¹æ“š Step ä¾†åˆ¤æ–·éœ€è¦ç–ŠåŠ çš„é«˜åº¦
            let y = 0;
            switch (id) {
                case 'step1': y = 0; break;
                case 'step2': y = 66; break;
                case 'step3': y = 132; break;
                case 'step4': y = 198; break;
                case 'step5': y = 264; break;
            }

            // åŸ·è¡Œç•«é¢ç§»å‹•çš„å‹•ä½œ
            window.scrollTo({top: alertHeight + y, behavior: 'smooth'});
        },
    },
};
</script>
